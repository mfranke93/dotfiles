#!/bin/zsh
# vim: ft=zsh
#
# Launch a tmux session with office programs running: mutt, calcurse

# only start new if does not yet exist
tmux has-session -t office
if [ $? != 0 ]
then
    # launch session
    tmux -2 new-session -s office -n home -d

    # new windows
    tmux new-window -n calendar
    tmux new-window -n tasks

    # split
    tmux split-window -v -p 10 -t office:0
    tmux split-window -v -p 10 -t office:1
    tmux split-window -h -p 50 -t office:2

    # start mutt in window 0, pane 0, and offlineimap in pane 1 but do not yet
    # launch offlineimap. This is because both commands need pass, and thus
    # need input on the YubiKey.
    tmux send-keys -t office:0.0 'neomutt' C-m
    tmux send-keys -t office:0.1 'offlineimap'
    tmux rename-window -t office:0 mail

    # start calendar in window 1, pane 0
    tmux send-keys -t office:1.0 'khal interactive' C-m
    tmux send-keys -t office:1.1 'vdirsyncer sync' C-m

    # execute task in window 2, pane 0
    tmux send-keys -t office:2.0 'task shell' C-m
    tmux send-keys -t office:2.1 'while true; do clear; task next; inotifywait -qq -e modify .task/*.data; done'
    tmux select-pane -t office:2.0

    # go to window 0:mutt
    tmux select-window -t office:0
    tmux select-pane -t office:0.0
fi

(sleep 2 ; tmux send-keys -t office:2.1 ' ' C-m ; tmux resize-pane -t office:0.1 -y 10 ) &
tmux attach -t office
